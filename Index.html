<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Bingo Duel with AI Indicator & Persistent Coins</title>
<style>
body { font-family: Arial, sans-serif; background: #f0f8ff; text-align: center; margin:0; padding:0;}
h1 { margin: 20px; }
#controls { margin-bottom: 10px; }
button { padding: 10px 20px; font-size:16px; margin-right:10px; }
#coins { font-size: 20px; margin-bottom: 10px; }
#drawn-number { font-size: 24px; margin: 10px; }
.board-container { display: flex; justify-content: center; flex-wrap: wrap; gap: 20px; margin-bottom:20px; }
.board-wrapper { overflow-x: auto; max-width: 320px; border: 2px solid #333; padding: 10px; border-radius: 10px; background: #fff;}
.board { display: grid; grid-template-columns: repeat(5, 60px); grid-gap: 5px; }
.cell { width: 60px; height: 60px; display: flex; align-items: center; justify-content: center;
      border: 2px solid #333; border-radius: 8px; background: #fff; cursor: pointer; font-weight: bold; font-size:18px;}
.marked { background: #90ee90; }
.ai-board .cell.marked { background: #add8e6; cursor: default; }
.ai-board .cell.ai-mark { animation: flashAI 0.5s; }
#winner { font-size: 24px; color: red; margin: 15px; }
.flash { animation: flashGreen 0.6s infinite; }
@keyframes flashGreen {0% { background-color: #90ee90; } 50% { background-color: #00ff00; } 100% { background-color: #90ee90; }}
@keyframes flashAI { 0% { background-color: #add8e6; } 50% { background-color: #87ceeb; } 100% { background-color: #add8e6; }}
</style>
</head>
<body>

<h1>Bingo Duel</h1>

<div id="controls">
  <button onclick="startGame()">Start</button>
  <button onclick="closeGame()">Close</button>
  <button onclick="restartGame()">Restart</button>
</div>

<div id="coins">Coins: ðŸª™ 0</div>
<div id="drawn-number">Next Number: --</div>

<div class="board-container" id="boards">
  <div class="board-wrapper">
    <h3>Your Board</h3>
    <div id="player-board" class="board"></div>
  </div>
  <div class="board-wrapper">
    <h3>AI Board</h3>
    <div id="ai-board" class="board ai-board"></div>
  </div>
</div>

<div id="winner"></div>

<audio id="soundDraw" src="https://www.soundjay.com/button/sounds/button-3.mp3"></audio>
<audio id="soundMark" src="https://www.soundjay.com/button/sounds/button-16.mp3"></audio>
<audio id="soundWin" src="https://www.soundjay.com/misc/sounds/bell-ringing-01.mp3"></audio>

<script>
const width=5;
let playerBoard=[], aiBoard=[];
let drawnNumbers=[], availableNumbers=[], currentDrawn=null;
let gameInterval=null;
let coins=0;
let gameClosed=false;

// Load local storage
if(localStorage.getItem('bingoCoins')) coins=parseInt(localStorage.getItem('bingoCoins'));
document.getElementById('coins').textContent=`Coins: ðŸª™ ${coins}`;

const soundDraw=document.getElementById('soundDraw');
const soundMark=document.getElementById('soundMark');
const soundWin=document.getElementById('soundWin');

function shuffle(array){for(let i=array.length-1;i>0;i--){const j=Math.floor(Math.random()*(i+1));[array[i],array[j]]=[array[j],array[i]];}return array;}

function generateBoard(){
  const board=[];
  const nums=shuffle(Array.from({length:75},(_,i)=>i+1));
  for(let i=0;i<width*width;i++){board.push({number: nums[i], marked:false});}
  return board;
}

function renderBoard(board, containerId, clickable=true, highlightAIIndex=null){
  const container=document.getElementById(containerId);
  container.innerHTML='';
  board.forEach((cell,index)=>{
    const div=document.createElement('div');
    div.className='cell'+(cell.marked?' marked':'');
    div.textContent=cell.number;
    if(containerId==='ai-board' && index===highlightAIIndex){
      div.classList.add('ai-mark');
    }
    if(clickable){
      div.onclick=()=>{
        if(cell.number===currentDrawn && !cell.marked){
          cell.marked=true;
          div.classList.add('marked');
          coins+=10;
          soundMark.play();
          localStorage.setItem('bingoCoins',coins);
          updateScoreboard();
          saveBoards();
          checkWinner();
        }
      };
    }
    container.appendChild(div);
  });
}

function drawNumber(){
  if(availableNumbers.length===0){ clearInterval(gameInterval); return; }
  const idx=Math.floor(Math.random()*availableNumbers.length);
  currentDrawn=availableNumbers.splice(idx,1)[0];
  drawnNumbers.push(currentDrawn);
  document.getElementById('drawn-number').textContent='Next Number: '+currentDrawn;
  soundDraw.play();

  // AI marks
  let aiMarkedIndex=null;
  aiBoard.forEach((cell,i)=>{
    if(cell.number===currentDrawn && !cell.marked){
      cell.marked=true;
      coins-=2;
      aiMarkedIndex=i;
    }
  });

  updateScoreboard();
  renderBoard(playerBoard,'player-board');
  renderBoard(aiBoard,'ai-board',false, aiMarkedIndex);
  saveBoards();
  checkWinner();
}

function checkBingo(board){
  // Check rows
  for(let r=0;r<width;r++){
    if(board.slice(r*width,r*width+width).every(c=>c.marked)){
      return {win:true,indices:Array.from({length:width},(_,i)=>r*width+i)};
    }
  }
  // Check columns
  for(let c=0;c<width;c++){
    let colIndices=[];
    for(let r=0;r<width;r++){colIndices.push(r*width+c);}
    if(colIndices.every(i=>board[i].marked)) return {win:true,indices:colIndices};
  }
  // Check diagonals
  let diag1=[], diag2=[];
  for(let i=0;i<width;i++){diag1.push(i*width+i); diag2.push(i*width+(width-1-i));}
  if(diag1.every(i=>board[i].marked)) return {win:true,indices:diag1};
  if(diag2.every(i=>board[i].marked)) return {win:true,indices:diag2};
  // Full House
  if(board.every(c=>c.marked)) return {win:true,indices:Array.from({length:width*width},(_,i)=>i)};
  return {win:false};
}

function checkWinner(){
  let playerWin=checkBingo(playerBoard);
  let aiWin=checkBingo(aiBoard);

  if(playerWin.win){
    highlightWinningLine('player-board', playerWin.indices);
    endGame('Player Wins!');
  } else if(aiWin.win){
    highlightWinningLine('ai-board', aiWin.indices);
    endGame('AI Wins!');
  }
}

function highlightWinningLine(boardId, indices){
  const board=document.getElementById(boardId);
  indices.forEach(i=>board.children[i].classList.add('flash'));
}

function endGame(msg){
  clearInterval(gameInterval);
  document.getElementById('winner').textContent=msg;
  soundWin.play();
}

function updateScoreboard(){document.getElementById('coins').textContent=`Coins: ðŸª™ ${coins}`;}

function saveBoards(){
  localStorage.setItem('playerBoard',JSON.stringify(playerBoard));
  localStorage.setItem('aiBoard',JSON.stringify(aiBoard));
  localStorage.setItem('drawnNumbers',JSON.stringify(drawnNumbers));
  localStorage.setItem('availableNumbers',JSON.stringify(availableNumbers));
  localStorage.setItem('currentDrawn',currentDrawn);
  localStorage.setItem('bingoCoins',coins);
}

function startGame(){
  gameClosed=false;
  document.getElementById('boards').style.display='flex';
  if(playerBoard.length===0 || aiBoard.length===0 || drawnNumbers.length===0){
    playerBoard=generateBoard();
    aiBoard=generateBoard();
    drawnNumbers=[];
    availableNumbers=Array.from({length:75},(_,i)=>i+1);
    currentDrawn=null;
    saveBoards();
  }
  document.getElementById('winner').textContent='';
  renderBoard(playerBoard,'player-board');
  renderBoard(aiBoard,'ai-board',false);
  gameInterval=setInterval(drawNumber,6000);
}

function closeGame(){
  gameClosed=true;
  clearInterval(gameInterval);
  document.getElementById('boards').style.display='none';
  document.getElementById('drawn-number').textContent='Game Closed';
  document.getElementById('winner').textContent='';
}

function restartGame(){
  clearInterval(gameInterval);
  // Reset boards and numbers only, keep coins
  playerBoard=generateBoard();
  aiBoard=generateBoard();
  drawnNumbers=[];
  availableNumbers=Array.from({length:75},(_,i)=>i+1);
  currentDrawn=null;
  document.getElementById('winner').textContent='';
  document.getElementById('drawn-number').textContent='Next Number: --';
  saveBoards();
  startGame();
}

startGame(); // auto-start if data exists
</script>

</body>
</html>
